"use client";

import { useEffect, useMemo, useState } from "react";
import { useRouter } from "next/navigation";

type UserProfile = {
  username: string;
  bio: string;
  avatar: string;
  handle?: string;
  handleLastChangedAt?: string;
};

type VideoRow = {
  id: string;
  user_id: string | null;
  title: string | null;
  description?: string;
  video_url: string;
  created_at: string;
};

export default function ProfileViewPage() {
  const router = useRouter();
  const [profile, setProfile] = useState<UserProfile>({ username: "", bio: "", avatar: "ğŸ‘¤" });
  const [videos, setVideos] = useState<VideoRow[]>([]);
  const [savedVideos, setSavedVideos] = useState<VideoRow[]>([]);
  const [themeColor, setThemeColor] = useState<string>("#ff1493");
  const [backgroundColor, setBackgroundColor] = useState<"dark" | "light">("dark");
  const [ideaMessages, setIdeaMessages] = useState<{ id: string; role: "ai" | "user"; text: string }[]>([
    {
      id: "ai-welcome",
      role: "ai",
      text: "ã©ã‚“ãªãƒšãƒ¼ã‚¸ã«ã—ãŸã„ã‹æ•™ãˆã¦ãã ã•ã„ã€‚ç›®çš„ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ»é›°å›²æ°—ã‚’æ›¸ã‘ã°ã€AIãŒãƒã‚¿æ¡ˆã‚„æ§‹æˆã‚’ææ¡ˆã—ã¾ã™ã€‚",
    },
  ]);
  const [pageGoal, setPageGoal] = useState("");
  const [pageAudience, setPageAudience] = useState("");
  const [pageTone, setPageTone] = useState("");

  useEffect(() => {
    const savedSettings = localStorage.getItem("appSettings");
    const settings = savedSettings ? JSON.parse(savedSettings) : {};
    const color = settings.themeColor || "pink";
    const bgColor = settings.backgroundColor || "dark";
    const themeMap: Record<string, string> = {
      pink: "#ff1493",
      blue: "#64b5f6",
      green: "#81c784",
      purple: "#9d4edd",
    };
    setThemeColor(themeMap[color] || "#ff1493");
    setBackgroundColor(bgColor);

    // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
    let userId = null;
    const userSessionRaw = sessionStorage.getItem("currentUser") || localStorage.getItem("currentUser");
    if (userSessionRaw) {
      try {
        const parsed = JSON.parse(userSessionRaw);
        userId = parsed.id;
      } catch {}
    }
    if (userId) {
      const savedProfile = localStorage.getItem(`userProfile_${userId}`);
      if (savedProfile) {
        setProfile(JSON.parse(savedProfile));
      }
    }

    const userSessionRaw2 = sessionStorage.getItem("currentUser");
    const storedUser = userSessionRaw2 || localStorage.getItem("currentUser");
    if (storedUser) {
      try {
        const parsed = JSON.parse(storedUser);
        const users = JSON.parse(localStorage.getItem("aiplus_users") || "[]");
        const me = users.find((u: any) => u.id === parsed?.id);
        if (me?.handle) {
          setProfile((prev) => ({ ...prev, handle: me.handle }));
        }
      } catch {
        // ignore
      }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®æŠ•ç¨¿ã®ã¿è¡¨ç¤º
    let userVideos: VideoRow[] = [];
    if (userId) {
      const userVideosRaw = localStorage.getItem(`videos_${userId}`);
      if (userVideosRaw) {
        userVideos = JSON.parse(userVideosRaw);
      }
    }
    setVideos(userVideos);

    const saved = localStorage.getItem("savedVideos");
    const savedList = saved ? JSON.parse(saved) : [];
    setSavedVideos(savedList);

    const handleThemeChange = (e: Event) => {
      const ce = e as CustomEvent;
      if (ce.detail) {
        const color = ce.detail.themeColor || "pink";
        const bgColor = ce.detail.backgroundColor || "dark";
        const themeMap: Record<string, string> = {
          pink: "#ff1493",
          blue: "#64b5f6",
          green: "#81c784",
          purple: "#9d4edd",
        };
        setThemeColor(themeMap[color] || "#ff1493");
        setBackgroundColor(bgColor);
      }
    };
    window.addEventListener("themeChanged", handleThemeChange);
    return () => window.removeEventListener("themeChanged", handleThemeChange);
  }, []);

  const pushIdeaMessage = (role: "ai" | "user", text: string) => {
    setIdeaMessages((prev) => [...prev, { id: `${role}-${Date.now()}-${Math.random().toString(16).slice(2, 6)}`, role, text }]);
  };

  const handleGenerateIdeas = () => {
    const goal = pageGoal.trim() || "ãƒ•ã‚¡ãƒ³ãŒé›†ã¾ã‚‹è‡ªå·±ç´¹ä»‹ãƒšãƒ¼ã‚¸";
    const audience = pageAudience.trim() || "å‹•ç”»ã‚’è¦‹ã¦ãã‚Œã‚‹æ½œåœ¨ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼";
    const tone = pageTone.trim() || "è¦ªã—ã¿ã‚„ã™ããƒ¯ã‚¯ãƒ¯ã‚¯";

    pushIdeaMessage("user", `ç›®çš„: ${goal}\nã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ${audience}\né›°å›²æ°—: ${tone}`);

    const suggestions = [
      `ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ˆ: ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¨ãƒªã‚¢ã«1ãƒ•ãƒ¬ãƒ¼ã‚ºã®ã‚­ãƒ£ãƒƒãƒã¨æœ€æ–°å‹•ç”»1æœ¬ã‚’åŸ‹ã‚è¾¼ã¿ã€‚ä¸‹ã«ã€Œäººæ°—3æœ¬ã€ã€Œã¯ã˜ã‚ã¦ã®äººã¯ã“ã‚Œã€ã‚’ã‚«ãƒ¼ãƒ‰ã§ä¸¦ã¹ã‚‹ã€‚`,
      `CTA: ãƒ•ã‚©ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ã¨ã€Œæ¬¡ã®ãƒ©ã‚¤ãƒ–äºˆå®šã€ã‚’ä¸¦åˆ—é…ç½®ã€‚ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†’é ­ã«1ã¤ã ã‘å¼·ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç½®ãã€‚`,
      `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¡ˆ: ${goal} ã‚’è»¸ã«ã€\n- 30ç§’ã§ã‚ã‹ã‚‹è‡ªå·±ç´¹ä»‹ã‚·ãƒ§ãƒ¼ãƒˆ\n- æ¯é€±ã®è£å´Vlogãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ\n- è¦–è´è€…ã®è³ªå•ã«ç­”ãˆã‚‹Q&Aã‚¹ãƒ¬ãƒƒãƒ‰`,
      `ãƒˆãƒ¼ãƒ³: ${tone} ã«åˆã‚ã›ã¦è‰²ã¯ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’è–„ã‚ãŸã‚°ãƒ©ãƒ‡èƒŒæ™¯ã€ãƒ•ã‚©ãƒ³ãƒˆã¯èª­ã¿ã‚„ã™ã•å„ªå…ˆã€‚`,
      `åç›Š/èª˜å°: ç„¡æ–™ã‚ªãƒ•ã‚¡ãƒ¼ï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ/ãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰ã‚’ãƒšãƒ¼ã‚¸ä¸­æ®µã«è¨­ç½®ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚„SNSãƒªãƒ³ã‚¯ã‚’æ¨ªä¸¦ã³ã«ã€‚`,
      `æ”¹å–„ãƒ«ãƒ¼ãƒ—: ã‚¯ãƒªãƒƒã‚¯/å†ç”Ÿã®å¤šã„ãƒ–ãƒ­ãƒƒã‚¯ã‚’å„ªå…ˆè¡¨ç¤ºã€‚é€±1ã§ã€Œåå¿œãƒˆãƒƒãƒ—3ã€ã‚’å›ºå®šæ¬„ã«å·®ã—æ›¿ãˆã€‚`,
    ];

    pushIdeaMessage("ai", suggestions.join("\n\n"));
  };

  const topVideo = useMemo(() => videos[0], [videos]);

  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
  const handleLogout = () => {
    // currentUser, autoLoginUserIdã®ã¿å‰Šé™¤ã€‚ä»–ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã€‚
    sessionStorage.removeItem("currentUser");
    localStorage.removeItem("currentUser");
    localStorage.removeItem("autoLoginUserId");
    router.push("/login");
  };

  return (
    <div
      style={{
        display: "flex",
        flexDirection: "column",
        minHeight: "100vh",
        background: backgroundColor === "light" ? "#ffffff" : "linear-gradient(135deg, rgba(10,0,20,.98) 0%, rgba(15,5,25,.96) 100%)",
        color: backgroundColor === "light" ? "#333" : "white",
      }}
    >
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div
        style={{
          padding: "12px 16px",
          borderBottom: backgroundColor === "light" ? `1px solid ${themeColor}26` : `1px solid ${themeColor}40`,
          background: backgroundColor === "light"
            ? "linear-gradient(180deg, rgba(245,245,245,.95) 0%, rgba(240,240,240,.93) 100%)"
            : "linear-gradient(180deg, rgba(20,0,40,.95) 0%, rgba(30,5,60,.93) 100%)",
          boxShadow: backgroundColor === "light"
            ? "0 2px 16px rgba(0,0,0,.08), inset 0 -1px 0 rgba(0,0,0,.05)"
            : `0 2px 16px ${themeColor}33, inset 0 -1px 0 ${themeColor}1a`,
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          gap: 8,
        }}
      >
        <button
          onClick={() => router.push("/tabs/me")}
          style={{ background: "transparent", border: "none", color: themeColor, cursor: "pointer", fontSize: 15 }}
        >
          â†
        </button>
        <div style={{ flex: 1, textAlign: "center", fontWeight: 700, color: themeColor, fontSize: 18 }}>
          ãƒã‚¤ãƒšãƒ¼ã‚¸
        </div>
        <button
          onClick={handleLogout}
          style={{ background: "transparent", border: "none", color: themeColor, cursor: "pointer", fontSize: 15, fontWeight: 600, marginRight: 8 }}
          title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"
        >
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
        <button
          onClick={() => router.push("/settings")}
          style={{ background: "transparent", border: "none", color: themeColor, cursor: "pointer", fontSize: 20, padding: "4px 8px" }}
          title="ç®¡ç†ãƒšãƒ¼ã‚¸"
        >
          âš™
        </button>
      </div>

      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <div style={{ flex: 1, padding: 16, display: "flex", flexDirection: "column", gap: 16 }}>
        {/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ */}
        <div
          style={{
            padding: 16,
            borderRadius: 12,
            background: backgroundColor === "light"
              ? `linear-gradient(135deg, ${themeColor}05, ${themeColor}02)`
              : `linear-gradient(135deg, ${themeColor}1a, ${themeColor}0d)`,
            border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.08)" : themeColor}40`,
            boxShadow: backgroundColor === "light" ? "0 6px 18px rgba(0,0,0,.06)" : `0 8px 24px ${themeColor}22`,
            display: "flex",
            gap: 16,
            alignItems: "center",
            flexWrap: "wrap",
          }}
        >
          <div
            style={{
              width: 78,
              height: 78,
              borderRadius: "50%",
              background: backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}12, ${themeColor}05)`,
              border: `2px solid ${themeColor}66`,
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              fontSize: 36,
              overflow: "hidden",
            }}
          >
            {profile.avatar && !["ğŸ‘¤", "ğŸ˜Š", "ğŸ‰", "ğŸš€", "ğŸ’¡", "â­", "ğŸ¯", "ğŸ”¥"].includes(profile.avatar) ? (
              <img
                src={profile.avatar}
                alt="avatar"
                style={{
                  width: 64,
                  height: 64,
                  objectFit: "cover",
                  borderRadius: "50%",
                  border: `2px solid ${themeColor}`,
                  background: "#fff",
                  display: "block",
                  margin: "0 auto"
                }}
              />
            ) : (
              profile.avatar || "ğŸ‘¤"
            )}
          </div>
          <div style={{ flex: 1, minWidth: 220 }}>
            <div style={{ fontSize: 17, fontWeight: 700, color: themeColor, marginBottom: 6 }}>
              {profile.username || "ï¼ˆæœªè¨­å®šï¼‰"}
            </div>
            {profile.handle && (
              <div style={{ fontSize: 12, opacity: 0.75, marginBottom: 6 }}>
                @{profile.handle}
              </div>
            )}
            <div style={{ fontSize: 12, opacity: 0.75, whiteSpace: "pre-wrap", lineHeight: 1.6 }}>
              {profile.bio || "è‡ªå·±ç´¹ä»‹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“"}
            </div>
          </div>
        </div>

        {/* AIç›¸è«‡ - ãƒšãƒ¼ã‚¸ä¼ç”»è¨­å®š & AIã‚¢ã‚¤ãƒ‡ã‚¢ */}
        <div style={{ marginBottom: 16 }}>
          <div style={{ marginBottom: 12, opacity: 0.9, fontSize: 14, color: themeColor, fontWeight: 700 }}>
            ğŸ’¡ AIç›¸è«‡ - ãƒšãƒ¼ã‚¸ä¼ç”»è¨­å®š & AIã‚¢ã‚¤ãƒ‡ã‚¢
          </div>

          <div style={{ display: "grid", gap: 10, gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))", marginBottom: 12 }}>
            <div style={{ display: "flex", flexDirection: "column", gap: 6 }}>
              <label style={{ fontSize: 12, opacity: 0.75 }}>ã©ã‚“ãªãƒšãƒ¼ã‚¸ã«ã—ãŸã„ï¼Ÿ</label>
              <input
                value={pageGoal}
                onChange={(e) => setPageGoal(e.target.value)}
                placeholder="ä¾‹: åˆè¦‹ã•ã‚“å‘ã‘ã®è‡ªå·±ç´¹ä»‹"
                style={{
                  padding: "10px 12px",
                  borderRadius: 10,
                  border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.12)" : themeColor}40`,
                  background: backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}1a, ${themeColor}0d)`,
                  color: backgroundColor === "light" ? "#333" : "white",
                  fontSize: 13,
                }}
              />
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 6 }}>
              <label style={{ fontSize: 12, opacity: 0.75 }}>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ/èª­è€…</label>
              <input
                value={pageAudience}
                onChange={(e) => setPageAudience(e.target.value)}
                placeholder="ä¾‹: å‹‰å¼·ç³»ã‚·ãƒ§ãƒ¼ãƒˆå¥½ããª20ä»£"
                style={{
                  padding: "10px 12px",
                  borderRadius: 10,
                  border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.12)" : themeColor}40`,
                  background: backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}1a, ${themeColor}0d)`,
                  color: backgroundColor === "light" ? "#333" : "white",
                  fontSize: 13,
                }}
              />
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 6 }}>
              <label style={{ fontSize: 12, opacity: 0.75 }}>é›°å›²æ°—/ãƒˆãƒ¼ãƒ³</label>
              <input
                value={pageTone}
                onChange={(e) => setPageTone(e.target.value)}
                placeholder="ä¾‹: è¦ªã—ã¿ã‚„ã™ãã€ãƒ¯ã‚¯ãƒ¯ã‚¯"
                style={{
                  padding: "10px 12px",
                  borderRadius: 10,
                  border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.12)" : themeColor}40`,
                  background: backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}1a, ${themeColor}0d)`,
                  color: backgroundColor === "light" ? "#333" : "white",
                  fontSize: 13,
                }}
              />
            </div>
          </div>

          <button
            onClick={handleGenerateIdeas}
            style={{
              width: "100%",
              padding: "12px 16px",
              borderRadius: 10,
              border: `1px solid ${themeColor}80`,
              background: `linear-gradient(135deg, ${themeColor}bf, ${themeColor}a6)`,
              color: "white",
              fontWeight: 700,
              cursor: "pointer",
              boxShadow: `0 10px 24px ${themeColor}33`,
              marginBottom: 12,
            }}
          >
            AIã«ææ¡ˆã—ã¦ã‚‚ã‚‰ã†
          </button>

          <div
            style={{
              borderRadius: 12,
              border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.08)" : themeColor}40`,
              background: backgroundColor === "light"
                ? `linear-gradient(135deg, ${themeColor}04, ${themeColor}08)`
                : `linear-gradient(135deg, ${themeColor}18, ${themeColor}0d)`,
              padding: 12,
              display: "flex",
              flexDirection: "column",
              gap: 10,
              maxHeight: 240,
              overflowY: "auto",
            }}
          >
            {ideaMessages.map((m) => (
              <div
                key={m.id}
                style={{
                  alignSelf: m.role === "user" ? "flex-end" : "flex-start",
                  maxWidth: "92%",
                  padding: "10px 12px",
                  borderRadius: 10,
                  background: m.role === "user"
                    ? backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}10, ${themeColor}05)`
                    : backgroundColor === "light" ? `${themeColor}12` : `linear-gradient(135deg, ${themeColor}22, ${themeColor}12)`,
                  border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.08)" : themeColor}30`,
                  color: backgroundColor === "light" ? "#333" : "white",
                  whiteSpace: "pre-wrap",
                  lineHeight: 1.5,
                  fontSize: 12,
                  boxShadow: backgroundColor === "light" ? "0 2px 8px rgba(0,0,0,.06)" : `0 4px 14px ${themeColor}1f`,
                }}
              >
                {m.text}
              </div>
            ))}
          </div>
        </div>

        {/* ãƒã‚¤ãƒ©ã‚¤ãƒˆå‹•ç”» */}
        {topVideo && (
          <div
            style={{
              padding: 14,
              borderRadius: 12,
              background: backgroundColor === "light" ? "#ffffff" : `linear-gradient(135deg, ${themeColor}12, ${themeColor}06)`,
              border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.08)" : themeColor}40`,
              boxShadow: backgroundColor === "light" ? "0 4px 14px rgba(0,0,0,.06)" : `0 6px 18px ${themeColor}22`,
            }}
          >
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
              <div style={{ fontSize: 14, fontWeight: 700, color: themeColor }}>æ³¨ç›®ã®å‹•ç”»</div>
              <div style={{ fontSize: 11, opacity: 0.65 }}>{new Date(topVideo.created_at).toLocaleString()}</div>
            </div>
            <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
              <div style={{ flex: "1 1 220px", minWidth: 220, maxWidth: 360 }}>
                <video
                  src={topVideo.video_url}
                  controls
                  style={{ width: "100%", borderRadius: 10, border: `1px solid ${backgroundColor === "light" ? "rgba(0,0,0,.08)" : themeColor}26`, maxHeight: 240, objectFit: "cover" }}
                />
              </div>
              <div style={{ flex: "1 1 220px", minWidth: 220 }}>
                <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 6 }}>{topVideo.title || "ã‚¿ã‚¤ãƒˆãƒ«ãªã—"}</div>
                <div style={{ fontSize: 11, opacity: 0.7, marginBottom: 8, lineHeight: 1.6 }}>
                  {topVideo.description || "èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“"}
                </div>
                <div style={{ fontSize: 11, opacity: 0.65 }}>
                  {topVideo.created_at ? new Date(topVideo.created_at).toLocaleDateString() : ""}
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ä¿å­˜ã—ãŸå‹•ç”» */}
        <div>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: themeColor }}>
              ä¿å­˜ã—ãŸå‹•ç”» ({savedVideos.length})
            </div>
            {savedVideos.length > 0 && (
              <button
                onClick={() => router.push("/tabs/saved")}
                style={{
                  padding: "6px 12px",
                  borderRadius: 8,
                  border: `1px solid ${themeColor}66`,
                  background: `linear-gradient(135deg, ${themeColor}4d, ${themeColor}33)`,
                  color: "white",
                  fontSize: 12,
                  fontWeight: 600,
                  cursor: "pointer",
                  boxShadow: `0 4px 12px ${themeColor}26`,
                }}
              >
                ã™ã¹ã¦è¦‹ã‚‹ â†’
              </button>
            )}
          </div>
          {savedVideos.length === 0 ? (
            <div style={{ opacity: 0.7, fontSize: 14 }}>ã¾ã ä¿å­˜ã—ãŸå‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</div>
          ) : (
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(120px, 1fr))", gap: 10 }}>
              {savedVideos.slice(0, 6).map((v, idx) => (
                <div key={`saved-${v.id}-${idx}`} style={{ position: "relative", paddingBottom: "100%", overflow: "hidden", borderRadius: 8 }}>
                  <video
                    src={v.video_url}
                    controls
                    style={{ position: "absolute", top: 0, left: 0, width: "100%", height: "100%", objectFit: "cover" }}
                  />
                </div>
              ))}
            </div>
          )}
        </div>

        {/* æŠ•ç¨¿ã‚°ãƒªãƒƒãƒ‰ */}
        <div>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: themeColor }}>æŠ•ç¨¿ä¸€è¦§ ({videos.length})</div>
          </div>
          {videos.length === 0 ? (
            <div style={{ opacity: 0.7, fontSize: 14 }}>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
          ) : (
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(110px, 1fr))", gap: 10 }}>
              {videos.map((v, idx) => (
                <div key={`post-${v.id}-${idx}`} style={{ position: "relative", paddingBottom: "100%", overflow: "hidden", borderRadius: 8 }}>
                  <video
                    src={v.video_url}
                    style={{ position: "absolute", top: 0, left: 0, width: "100%", height: "100%", objectFit: "cover" }}
                  />
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
